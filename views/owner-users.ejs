<%- include('./partials/header') %>

<!-- ================= USERS SECTION ================= -->
<section class="min-h-screen pt-28 pb-20 px-6">
  <div class="max-w-7xl mx-auto">

    <!-- HERO HEADER -->
    <div
      class="mb-16 text-center rounded-3xl
             bg-white/5 backdrop-blur-xl
             border border-white/10
             p-10 shadow-2xl">

      <span class="inline-block mb-6 px-6 py-2 rounded-full
                   bg-white/20 text-sm backdrop-blur">
        üë• User Management
      </span>

      <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">
        Registered
        <span class="block mt-2
                     bg-gradient-to-r from-yellow-300 to-orange-400
                     bg-clip-text text-transparent">
          Users
        </span>
      </h1>

      <p class="mt-6 text-lg text-white/70">
        Manage all users registered on Scatch in one place
      </p>
    </div>

    <!-- USERS TABLE -->
    <div
      class="overflow-x-auto rounded-3xl
             bg-white/10 backdrop-blur-xl
             border border-white/20 shadow-2xl">

      <table class="w-full text-white text-center">
        <thead class="bg-white/10 uppercase tracking-wider text-sm">
          <tr>
            <th class="py-6">#</th>
            <th>Name</th>
            <th>Email</th>
            <th>Email Status</th>
            <th>Joined</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody>
          <% users.forEach((u, i) => { %>

            <tr class="border-t border-white/10 hover:bg-white/10 transition-all duration-300">

              <td class="py-6 text-white/60"><%= i + 1 %></td>

              <td class="font-semibold">
                <%= u.fullname || "N/A" %>
              </td>

              <td class="text-white/80">
                <%= u.email %>
              </td>

              <!-- EMAIL VERIFIED STATUS -->
              <td>
                <% if (u.isVerified) { %>
                  <span class="px-4 py-1 rounded-full text-sm font-semibold
                               bg-green-500/20 text-green-400
                               border border-green-400/30">
                    ‚úÖ Verified
                  </span>
                <% } else { %>
                  <span class="px-4 py-1 rounded-full text-sm font-semibold
                               bg-red-500/20 text-red-400
                               border border-red-400/30">
                    ‚ùå Not Verified
                  </span>
                <% } %>
              </td>

              <td class="text-sm text-white/60">
                <%= u.createdAt?.toDateString() || "-" %>
              </td>

              <td class="py-4">
                <form id="deleteForm-<%= u._id %>"
                      action="/owners/users/delete/<%= u._id %>"
                      method="POST">

                  <button type="button"
                    onclick="openDeleteModal('<%= u._id %>')"
                    class="px-6 py-2 rounded-xl font-semibold text-zinc-900
                           bg-gradient-to-r from-red-400 to-red-600
                           hover:scale-105 hover:shadow-xl
                           hover:shadow-red-500/30 transition-all">
                    Delete
                  </button>

                </form>
              </td>

            </tr>

          <% }) %>

          <% if (users.length === 0) { %>
            <tr>
              <td colspan="6" class="py-20 text-white/70 text-lg">
                No users found üö´
              </td>
            </tr>
          <% } %>
        </tbody>
      </table>

    </div>
  </div>
</section>

<!-- ================= DELETE CONFIRM MODAL ================= -->
<div id="deleteModal"
     class="fixed inset-0 z-50 hidden
            flex items-center justify-center
            bg-black/60 backdrop-blur-sm">

  <div class="bg-zinc-900 rounded-3xl p-8 w-full max-w-md
              border border-white/20 shadow-2xl text-center">

    <div class="text-5xl mb-4">‚ö†Ô∏è</div>

    <h2 class="text-2xl font-bold mb-2">
      Delete User?
    </h2>

    <p class="text-white/70 mb-8">
      This action cannot be undone.
    </p>

    <div class="flex justify-center gap-4">
      <button onclick="closeDeleteModal()"
              class="px-6 py-2 rounded-xl
                     bg-white/20 hover:bg-white/30 transition">
        Cancel
      </button>

      <button id="confirmDeleteBtn"
              class="px-6 py-2 rounded-xl font-semibold
                     bg-gradient-to-r from-red-500 to-red-700
                     hover:scale-105 transition">
        Yes, Delete
      </button>
    </div>

  </div>
</div>

<!-- ================= SCRIPT ================= -->
<script>
  let deleteFormId = null;

  function openDeleteModal(userId) {
    deleteFormId = `deleteForm-${userId}`;
    document.getElementById("deleteModal").classList.remove("hidden");
  }

  function closeDeleteModal() {
    document.getElementById("deleteModal").classList.add("hidden");
    deleteFormId = null;
  }

  document.getElementById("confirmDeleteBtn").addEventListener("click", () => {
    if (deleteFormId) {
      document.getElementById(deleteFormId).submit();
    }
  });
</script>
